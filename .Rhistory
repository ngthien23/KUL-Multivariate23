setwd("C:/Users/camd1/OneDrive - KU Leuven/2. Master of Statistics and Data Science 22-24/Year 1/Semester 1/Multivariate Statistics/Assignments")
library(psych)
library(lavaan)
library(candisc)
#function composite reliability
compositerel<-function(x){
A<-(sum(x))^2
B<-sum(1-x^2)
return(A/(A+B))
}
load("ess.Rdata")
ess <- ess[-1]
names(ess)[1:13]<-c("sotru1","sotru2","sotru3","truin1","truin2","truin3","truin4",
"webe1","webe2","webe3","webe4","webe5","webe6")
covmat<-cov(ess)
##################################
#analysis
##################################
##specify model with 3 correlated factors
cfa1<-'sotru =~NA*+sotru1+sotru2+sotru3
truin =~NA*truin1+truin2+truin3+truin4
webe  =~NA*webe1+webe2+webe3+webe4+webe5+webe6
sotru ~~1*sotru
truin ~~1*truin
webe  ~~1*webe'
#fit model on covariance matrix
fitcfa1<-cfa(cfa1,sample.cov=covmat,sample.nobs=4046)
#summary of results
summary(fitcfa1,fit.measures=TRUE,std=TRUE)
#print fit measures
fitmeasures(fitcfa1,c("chisq","df","pvalue","cfi","tli","rmsea","srmr"))
#standardized solution
d<-standardizedSolution(fitcfa1)
d
factorscore<-c("sotru","truin","webe")
#composite reliability
reliability<-round(c(compositerel(d[1:3,4]),compositerel(d[4:6,4]),compositerel(d[7:9,4])),3)
#average variance extracted
average_var_extracted<-round(c(mean(d[1:3,4]^2),mean(d[4:6,4]^2),mean(d[7:9,4]^2)),3)
#maximum shared variance
max_shared_var<-round(c(max(d[c(22,23),4]^2),max(d[c(22,24),4]^2),max(d[c(23,24),4]^2)),3)
data.frame(factorscore,reliability,average_var_extracted,max_shared_var)
